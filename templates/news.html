    <!DOCTYPE html>
    <html>
    <head>
        <title>GDELT News</title>
        <link
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
        rel="stylesheet"
        />
        <link
        rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
        />
        <style>
        :root {
            --primary-bg: #f8f9fa;
            --card-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition-speed: 0.3s;
        }

        body {
            background-color: var(--primary-bg);
            font-family: "Segoe UI", system-ui, -apple-system, sans-serif;
        }

        .navbar {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .category-cards-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            max-width: 100%;
            width: 100%;
        }

        .stats-card {
            border: none;
            border-radius: 16px;
            transition: transform var(--transition-speed),
            box-shadow var(--transition-speed);
            overflow: hidden;
            cursor: pointer;
        }

        .stats-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--card-shadow);
        }

        .stats-number {
            font-size: 3rem;
            font-weight: 700;
            line-height: 1;
            margin-bottom: 0.5rem;
        }

        .news-card {
            border: none;
            border-radius: 16px;
            transition: all var(--transition-speed);
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            height: 100%;
            opacity: 0;
            animation: fadeIn 0.5s ease-out forwards;
        }

        .news-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--card-shadow);
        }

        .news-image {
            height: 200px;
            object-fit: cover;
            transition: transform var(--transition-speed);
        }

        .news-card:hover .news-image {
            transform: scale(1.05);
        }

        .category-badge {
            padding: 0.5em 1em;
            border-radius: 50px;
            font-weight: 600;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all var(--transition-speed);
            margin-bottom: 10px;
            display: block;
            width: fit-content;
        }

        .filter-btn {
            border-radius: 50px;
            padding: 0.5rem 1.25rem;
            transition: all var(--transition-speed);
            border: none;
            margin: 0 0.25rem;
        }

        .filter-btn.active {
            transform: scale(1.05);
        }

        #refresh-btn {
            border-radius: 50px;
            padding: 0.5rem 1.25rem;
            transition: all var(--transition-speed);
            background: linear-gradient(45deg, #007bff, #00bcd4);
            border: none;
            color: white;
            box-shadow: 0 2px 4px rgba(0, 123, 255, 0.3);
        }

        #refresh-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 123, 255, 0.4);
        }

        .spin {
            animation: spin 1s linear infinite;
        }

        @keyframes fadeIn {
            from {
            opacity: 0;
            transform: translateY(20px);
            }
            to {
            opacity: 1;
            transform: translateY(0);
            }
        }

        @keyframes spin {
            from {
            transform: rotate(0deg);
            }
            to {
            transform: rotate(360deg);
            }
        }

        #last-updated {
            background: rgba(0, 0, 0, 0.05);
            padding: 0.5rem 1rem;
            border-radius: 50px;
            transition: all var(--transition-speed);
        }

        #loader {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(5px);
            border-radius: 16px;
            padding: 2rem;
            box-shadow: var(--card-shadow);
        }

        .spinner-border {
            width: 3rem;
            height: 3rem;
            color: #007bff;
        }

        /* Customize category colors with gradients */
        .category-water_disaster {
            background: linear-gradient(45deg, #1a65d6, #4e95ff);
        }

        .category-storm_disaster {
            background: linear-gradient(45deg, #ffc107, #ffdb4d);
        }

        .category-geological_diaster {
            background: linear-gradient(45deg, #28a745, #34ce57);
        }

        .category-extreme_weather {
            background: linear-gradient(45deg, #24e4da, #4ffff5);
        }

        /* Card animations */
        .animate-card {
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
            opacity: 0;
            transform: translateX(-20px);
            }
            to {
            opacity: 1;
            transform: translateX(0);
            }
        }
        </style>
    </head>
    <body>
        <div class="container">
        <nav class="navbar sticky-top mb-4">
            <div class="container">
            <h1 class="navbar-brand mb-0 h1 fs-2">GDELT News</h1>
            <div class="d-flex align-items-center">
                <small id="last-updated" class="text-muted me-3"></small>
                <button id="refresh-btn" class="btn">
                <span id="refresh-icon">ðŸ”„</span> Refresh
                </button>
            </div>
            </div>
        </nav>
        <div class="container category-cards-container">
            <div class="col-md-3">
            <div class="card stats-card text-white category-water_disaster">
                <div class="card-body">
                <h5 class="card-title">Water Disasters</h5>
                <p class="stats-number" id="water-count">0</p>
                </div>
            </div>
            </div>
            <div class="col-md-3">
            <div class="card stats-card text-white category-extreme_weather">
                <div class="card-body">
                <h5 class="card-title">Extreme Weather</h5>
                <p class="stats-number" id="extreme-count">0</p>
                </div>
            </div>
            </div>
            <div class="col-md-3">
            <div class="card stats-card text-white category-geological_diaster">
                <div class="card-body">
                <h5 class="card-title">Geological Events</h5>
                <p class="stats-number" id="geological-count">0</p>
                </div>
            </div>
            </div>
            <div class="col-md-3">
            <div class="card stats-card text-white category-storm_disaster">
                <div class="card-body">
                <h5 class="card-title">Storm Events</h5>
                <p class="stats-number" id="storm-count">0</p>
                </div>
            </div>
            </div>
        </div>
        <div class="mt-4 mb-4 text-center">
            <div class="btn-group" role="group">
            <button
                type="button"
                class="filter-btn btn btn-outline-primary active"
                data-filter="all"
            >
                All
            </button>
            <button
                type="button"
                class="filter-btn btn btn-outline-primary"
                data-filter="water_disaster"
            >
                Water
            </button>
            <button
                type="button"
                class="filter-btn btn btn-outline-primary"
                data-filter="storm_disaster"
            >
                Storm
            </button>
            <button
                type="button"
                class="filter-btn btn btn-outline-primary"
                data-filter="geological_diaster"
            >
                Geological
            </button>
            <button
                type="button"
                class="filter-btn btn btn-outline-primary"
                data-filter="extreme_weather"
            >
                Extreme Weather
            </button>
            </div>
        </div>
        <!-- Add loader -->
        <div id="loader">
            <div class="spinner-border text-primary" role="status">
            <span class="sr-only">Loading...</span>
            </div>
            <p class="mt-2">Fetching latest news...</p>
        </div>
        <div class="row g-4" id="news-container">
            {% for item in news_items %}
            <div class="col-md-6 mb-4">
            <div class="card">
                {% if item.socialimage %}
                <img
                src="{{ item.socialimage }}"
                alt="News Image"
                class="card-img-top"
                />
                {% endif %}
                <div class="card-body">
                <span class="mb-4 category-badge category-{{ item.category }}">
                    {{ item.category.replace('_', ' ') }}
                </span>
                <h5 class="card-title">
                    <a href="{{ item.url }}" target="_blank">{{ item.title }}</a>
                </h5>
                <p class="news-details">
                    Date: {{ item.seendate }} <br />
                    Source: {{ item.domain }} ({{ item.sourcecountry }}) <br />
                    Language: {{ item.language }}
                </p>
                </div>
            </div>
            </div>
            {% endfor %}
        </div>
        </div>
        <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
        <script>
        const CACHE_DURATION = 5 * 60 * 1000; // 5 minutes

        // Cache management functions
        function getCachedNews() {
            const cached = localStorage.getItem("newsCache");
            if (!cached) return null;

            const { timestamp, data } = JSON.parse(cached);
            const now = new Date().getTime();

            if (now - timestamp < CACHE_DURATION) {
            return { timestamp, data };
            }

            localStorage.removeItem("newsCache");
            return null;
        }

        function cacheNews(data) {
            const cacheData = {
            timestamp: new Date().getTime(),
            data: data,
            };
            localStorage.setItem("newsCache", JSON.stringify(cacheData));
        }

        // Function to render a single news item (keep your existing function)
        function renderNewsItem(item) {
            return `
        <div class="col-md-6 mb-4">
            <div class="card">
            ${
                item.socialimage
                ? `<img src="${item.socialimage}" alt="News Image" class="card-img-top"/>`
                : ""
            }
            <div class="card-body">
                <span class="category-badge category-${item.category}">
                ${item.category.replace("_", " ")}
                </span>
                <h5 class="card-title">
                <a href="/article/${encodeURIComponent(
                    item.url
                )}" class="article-link">${item.title}</a>
                </h5>
                <p class="news-details">
                Date: ${item.seendate} <br>
                Source: ${item.domain} (${item.sourcecountry}) <br>
                Language: ${item.language}
                </p>
            </div>
            </div>
        </div>
        `;
        }

        // Modified function to load and display news
        function loadNews(forceRefresh = false) {
            const cachedData = !forceRefresh && getCachedNews();

            if (cachedData) {
            $("#loader").hide();
            displayNewsData(cachedData.data);
            return;
            }

            $("#news-container").empty();
            $("#loader").show();

            if (forceRefresh) {
            const btn = $("#refresh-btn");
            const icon = $("#refresh-icon");
            btn.prop("disabled", true);
            icon.addClass("spin");
            }

            fetch("/get_news")
            .then((response) => response.json())
            .then((data) => {
                $("#loader").hide();
                cacheNews(data);
                displayNewsData(data);
            })
            .catch((error) => {
                $("#loader").html(
                '<p class="text-danger">Error loading news. Please refresh the page.</p>'
                );
                console.error("Error:", error);
            })
            .finally(() => {
                if (forceRefresh) {
                $("#refresh-btn").prop("disabled", false);
                $("#refresh-icon").removeClass("spin");
                }
            });
        }

        function updateTimestamp(timestamp) {
            const date = timestamp ? new Date(timestamp) : new Date();
            const formattedTime = date.toLocaleTimeString();
            const formattedDate = date.toLocaleDateString();
            $("#last-updated").text(
            `Last updated: ${formattedDate} ${formattedTime}`
            );
        }

        // Function to display news data
        function displayNewsData(data) {
            const newsContainer = $("#news-container");
            newsContainer.empty();
            data.forEach((item) => {
            newsContainer.append(renderNewsItem(item));
            });
            updateStatistics(data);

            // Update timestamp from cache or current time
            const cached = getCachedNews();
            updateTimestamp(cached ? cached.timestamp : null);

            // Reapply current filter if any
            const activeFilter = $(".btn-group .btn.active").data("filter");
            if (activeFilter && activeFilter !== "all") {
            $(".col-md-6").hide();
            $(`.col-md-6:has(.category-${activeFilter})`).show();
            }
        }

        // Keep your existing updateStatistics function
        function updateStatistics(data) {
            const counts = {
            water_disaster: 0,
            storm_disaster: 0,
            geological_diaster: 0,
            extreme_weather: 0,
            };

            data.forEach((item) => {
            counts[item.category]++;
            });

            $("#water-count").text(counts.water_disaster);
            $("#storm-count").text(counts.storm_disaster);
            $("#geological-count").text(counts.geological_diaster);
            $("#extreme-count").text(counts.extreme_weather);
        }

        // Document ready handlers
        $(document).ready(function () {
            // Initial load using cache if available
            loadNews();

            // Filter functionality
            $(".btn-group .btn").click(function () {
            $(".btn-group .btn").removeClass("active");
            $(this).addClass("active");

            const filter = $(this).data("filter");
            if (filter === "all") {
                $(".col-md-6").show();
            } else {
                $(".col-md-6").hide();
                $(`.col-md-6:has(.category-${filter})`).show();
            }
            });

            // Refresh button handler
            $("#refresh-btn").click(function () {
            loadNews(true); // Force refresh
            });
        });
        </script>
    </body>
    </html>
